##############################
### WINDOWS AND WORKSPACES ###
##############################

# See https://wiki.hypr.land/Configuring/Window-Rules/
# See https://wiki.hypr.land/Configuring/Workspace-Rules/

#################
# Layer rules
#################
# Rofi is often a *layer* (gtk-layer-shell), so use layerrule for blur/anim.
# Matching by namespace is the recommended way. :contentReference[oaicite:1]{index=1}
layerrule = blur on, ignore_alpha 1, match:namespace rofi
layerrule = no_anim on, match:namespace rofi


#################
# Window rules (named blocks)
#################

windowrule {
    # Ignore maximize requests from all apps.
    name = suppress-maximize-events
    match:class = .*

    suppress_event = maximize
}

windowrule {
    name = float-center-modals
    match:modal = true

    float = on
    center = on
    # optional: give modals a sane default size so they don’t open super tiny
    size = 900 650
}

windowrule {
    # Fix some dragging issues with XWayland
    name = fix-xwayland-drags
    match:class = ^$
    match:title = ^$
    match:xwayland = true
    match:float = true
    match:fullscreen = false
    match:pin = false

    no_focus = true
}

# Hyprland-run windowrule
windowrule {
    name = move-hyprland-run
    match:class = hyprland-run

    move = 20 (monitor_h-120)
    float = on
}

# Network Manager floating window rule
windowrule {
    name = float-nm-connection-editor
    match:class = ^Nm-connection-editor$

    float = on
    size = 800 600
    center = on
}

# Fix sharing with Discord / xwaylandvideobridge
windowrule {
    name = xwaylandvideobridge-fixes
    match:class = ^(xwaylandvideobridge)$

    opacity = 0.0 override 0.0 override 0.0 override
    no_anim = on
    no_initial_focus = on
    max_size = 1 1
    no_blur = on
}

windowrule {
    name = float-center-portals
    match:class = ^(xdg-desktop-portal-gtk|xdg-desktop-portal-kde|xdg-desktop-portal-hyprland)(.*)$

    float = on
    center = on
    size = 1000 700
}
windowrule {
    name = pinentry-stay-focused
    match:class = ^(pinentry-)(.*)$

    float = on
    center = on
    stay_focused = on
}
windowrule {
    name = pavucontrol-float
    match:class = ^(pavucontrol)$

    float = on
    center = on
    size = 900 650
}


#################
# Window rules (anonymous one-liners)
# Syntax: windowrule = match:..., effect value
# Hyprland 0.53+ syntax reference: :contentReference[oaicite:2]{index=2}
#################

# Float common utilities
# windowrule = match:class ^(Rofi)$, float on
windowrule = match:class ^(pavucontrol)$, float on

# Picture-in-picture + dialogs
windowrule = match:title ^(Picture in picture)$, match:class ^$, float on
windowrule = match:class ^(LibreWolf)$, match:title ^(Picture-in-Picture)$, float on
windowrule = match:class ^(brave|brave-browser)$, match:title ^(Save File)$, float on
windowrule = match:class ^(brave|brave-browser)$, match:title ^(Open File)$, float on

# Other floaters
windowrule = match:class ^(blueman-manager)$, float on
windowrule = match:class ^(org\.twosheds\.iwgtk)$, float on
windowrule = match:class ^(blueberry\.py)$, float on
windowrule = match:class ^(xdg-desktop-portal-gtk)$, float on
windowrule = match:class ^(geeqie)$, float on

# Opacity (override makes it exact, not a multiplier) :contentReference[oaicite:3]{index=3}
windowrule = match:class ^(Thunar)$,   opacity 0.92 override 0.92 override 0.92 override
windowrule = match:class ^(discord)$,  opacity 0.96 override 0.96 override 0.96 override
windowrule = match:class ^(VSCodium)$, opacity 0.90 override 0.90 override 0.90 override
windowrule = match:class ^(obsidian)$, opacity 0.88 override 0.88 override 0.88 override
windowrule = match:class ^(Code)$,     opacity 0.95 override 0.95 override 0.95 override

# Keep neovim fully opaque
windowrule = match:class ^(neovim)$, opacity 1.0 override 1.0 override 1.0 override

# Force tile for these
windowrule = match:class ^(librewolf)$, tile on
windowrule = match:class ^(spotify)$,   tile on


#################
# Mouse binds
#################
bindm = SUPER,mouse:272,movewindow
bindm = SUPER,mouse:273,resizewindow

#################
# Electron / Chromium popups & dialogs
#################

# Generic “file / permission / settings” popup titles that often tile incorrectly in Electron apps.
# (Works for Discord, Slack, Obsidian, VSCode, browsers, etc.)
windowrule {
    name = float-center-common-popups
    match:title = ^(Open File|Save File|Save As|Open|Choose Files|File Upload|Upload|Select file|Choose file|Pick a file|Permissions?|Permission Request|Share your screen|Choose what to share|Select a window|Authentication Required|About|Settings|Preferences)(.*)$

    float = on
    center = on
    size = 1000 700
}

# DevTools windows (Chromium/Electron)
windowrule {
    name = float-devtools
    match:title = ^(Developer Tools|DevTools)(.*)$

    float = on
    center = on
    size = 1200 800
}

# Discord tends to spawn extra windows; keep popups sane
windowrule {
    name = discord-popups
    match:class = ^(discord)$
    match:title = ^(Settings|Preferences|About|Open File|Save File|Save As|Permissions?|Share your screen)(.*)$

    float = on
    center = on
}

# Obsidian popups (if you use them)
windowrule {
    name = obsidian-popups
    match:class = ^(obsidian)$
    match:title = ^(Settings|Preferences|Open File|Save File|Save As)(.*)$

    float = on
    center = on
}

# VS Code / VSCodium popups
windowrule {
    name = vscode-popups
    match:class = ^(Code|VSCodium)$
    match:title = ^(Settings|Preferences|Open File|Save File|Save As)(.*)$

    float = on
    center = on
}
